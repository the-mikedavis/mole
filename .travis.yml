dist: trusty
sudo: required
language: elixir
elixir:
  - 1.7.2
otp_release:
  - 21.0
addons:
  postgresql: '9.5'
env:
  global:
    - PGPORT=5432
    - MIX_ENV=test VERBOSE_TEST=true

before_script:
  - nvm install 8.9.0

script:
  - mix format --check-formatted
  - mix compile --warnings-as-errors
  - mix coveralls
  - mix credo

before_deploy:
  - cd ./assets
  - yarn install
  - ./node_modules/.bin/webpack -p
  - cd ..
  - MIX_ENV=prod mix phx.digest
  - MIX_ENV=prod mix release --env=prod

branches:
  only:
    - master
    - /^v[\d.]+/

deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: OqKszh7hH07xsDKLiifdNV0wO9sLFXJUg51yDblST9Pcr5QTbhBfUCoIFC81cI7EQ9V7Mwine7+Sclso48ec/0Xb6FTFWrlYAuupLgi5haTEUtW98drmO3nBIbYDjTkt6HrsUgci/SnRmOLkbWeGwpQAShkqPnqIQR3ABHWRO/RyT+GQ1VyTdhMfADDTK/HkIDJD2FHyUdbw53EBqa4TfPCp6L+sNEkWeFI7QUVP47N2ggYokvN8p49XpJMLUN+Mchactt/lJX8yh4m8/izzANb9MhTQQeRNRI9x4/klb44sk8lHva0xGLD2yj2pFnXIDQsP57/0VdNKzNEg/AzFcFmHSwjz6y28VoK7uDDQcee+tOgriZfYClgd1gzzs+Y37Q3AN+/Rn8ywYI6TQQ80WAmypcEAbX17AxAhUXXgWW7qQ3QXBw/5RcU5DWevbN+4WCLdxTOEN0YH6X/oZti+p4ue6QcdixvlG2fu6btpWFZc/htTMzqnQd10lV/Uqesg063FeSVagV/5lL9Gdv00raDUZaMlnULvMsPxWf5nS28jP0LioXfC7LqtX1Uk5lC2BmMzjYJUmjg+UVAFgVM+t1XD1+q6RpUI/fOFawMRyxwO/8SoiGqclUV0CpbUU/6fgmrTrnEKSvAjSozMTxg1mlRFpc+RSayDeuO8ZNP3BeQ=
  file_glob: true
  file: _build/prod/rel/mole/releases/*/*.tar.gz
  on:
    tags: true
